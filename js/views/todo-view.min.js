var app=app||{},todos=[];!function(e){"use strict";app.TodoView=Backbone.View.extend({tagName:"li",template:_.template(e("#item-template").html()),events:{"tap label":"edit","swipeRight label":"toggleCompleted","swipeLeft label":"clear","keypress .edit":"updateOnEnter","blur .edit":"close","swipeUp label":"sortTodos","swipeDown label":"sortTodos","taphold label":"moveTodo","preswipeLeft label":"animate","preswipeRight label":"animate","dragRight label":"animate","dragLeft label":"animate","swipeCancel label":"animate"},animate:function(e){var t=this,o;("swipeCancel"==e.type||"dragLeft"==e.type||"dragRight"==e.type)&&t.$el.removeClass("preclear").removeClass("toggleCompleted"),"preswipeLeft"==e.type&&t.$el.addClass("preclear"),"preswipeRight"==e.type&&t.$el.addClass("toggleCompleted")},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"all",this.save)},save:function(){this.model.storage()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("completed",this.model.get("completed")),this.$input=this.$(".edit"),this},toggleCompleted:function(){var e=this;e.model.toggle(),e.$el.removeClass("toggleCompleted")},edit:function(){this.$el.addClass("editing"),this.$input.focus()},close:function(){var e=this.$input.val().trim();this.$input.val(e),e?this.model.set("content",e):this.clear(),this.$el.removeClass("editing")},updateOnEnter:function(e){e.which===ENTER_KEY&&this.close()},clear:function(){var e=this,t=0,o=this.model.collection;e.$el.addClass("clear"),e.$el.one("webkitTransitionEnd",function(){e.$el.one("webkitTransitionEnd",function(){e.model.destroy(),o.each(function(e){e.set("order",t),t++},e)})})},sortTodos:function(t){var o=this.model.get("order"),l=e(document.elementFromPoint(t.clientXend,t.clientYend)).attr("data-order"),s,i,a;l&&(l>o?(s=o,i=l,a=-1):(s=l,i=o,a=1),this.model.collection.each(function(e){e.get("order")==o?e.set("order",l):e.get("order")>=s&&e.get("order")<=i&&e.set("order",+e.get("order")+a)},this),this.model.collection.sort())},moveTodo:function(t){var o=this,l=0,s=[app.today.length,app.later.length,app.schedule.length];e("#move-to").addClass("show"),e(".card").addClass("blur"),e("#move-to li").one("tap",function(){if(0==l){var t=e(this).attr("data-category");o.model.set("category_id",t),o.model.set("order",s[t]),e(".card").removeClass("blur"),e("#move-to").removeClass("show");var i=o.model;o.clear(),0==t&&app.today.push(i),1==t&&app.later.push(i),2==t&&app.schedule.push(i),o.save(),l+=1}}),e("#move-to").one("tap",function(){e(".card").removeClass("blur"),e("#move-to").removeClass("show")})}})}($);